<script>
  const freeIllustrations = [
    {
      url: 'https://cdn.steemitimages.com/DQmZPi8epjt1qaEJrQzYs5p3K4FJgJNzvcyHjnep14C1ArF/Steemian.app%20profile%20picture%201.jpg',
      steemitLink: '![Steemian.app profile picture 1.jpg](https://cdn.steemitimages.com/DQmZPi8epjt1qaEJrQzYs5p3K4FJgJNzvcyHjnep14C1ArF/Steemian.app%20profile%20picture%201.jpg)',
      tags: ['logo', 'steemian', 'app', 'design'],
    },
    {
      url: 'https://steemitimages.com/0x0/https://cdn.steemitimages.com/DQmcygZfJkv1bSfAsUNJFx5aHgBPbsD3eHYJ9ew7jPdWGA5/IMG_2118%20Steemit%20Header.jpg',
      steemitLink: '![IMG_2118 Steemit Header.jpg](https://steemitimages.com/0x0/https://cdn.steemitimages.com/DQmcygZfJkv1bSfAsUNJFx5aHgBPbsD3eHYJ9ew7jPdWGA5/IMG_2118%20Steemit%20Header.jpg)',
      tags: ['oslo', 'steemit', 'appreciation', 'design'],
    },
    {
      url: 'https://cdn.steemitimages.com/DQmTpQ4Vga2dYJwjYi3RSmAC7KnWTxXTqRafaAZkMAqEkZg/Steemit%20IMG_2976.jpg',
      steemitLink: '![Steemit IMG_2976.jpg](https://cdn.steemitimages.com/DQmTpQ4Vga2dYJwjYi3RSmAC7KnWTxXTqRafaAZkMAqEkZg/Steemit%20IMG_2976.jpg)',
      tags: ['molde', 'saw', 'jigsaw', 'bush', 'work'],
    }
  ];
  
  const MISTAKEDICTIONARY = {
  'avove': 'above',
  'absense': 'absence',
  'accomodated': 'accommodated',
  'accomodate': 'accommodate',
  'accomodations': 'accommodations',
  'accomodation': 'accommodation',
  'acheived': 'achieved',
  'acheive': 'achieve',
  'accross': 'across',
  'agressive': 'aggressive',
  'agression': 'aggression',
  'apparantly': 'apparently',
  'appearences': 'appearances',
  'appearence': 'appearance',
  'arguements': 'arguments',
  'arguement': 'argument',
  'assasinations': 'assassinations',
  'assasination': 'assassination',
  'assasined': 'assassined',
  'assasin': 'assassin',
  'basicly': 'basically',
  'beginings': 'beginnings',
  'begining': 'beginning',
  'beleived': 'believed',
  'beleive': 'believe',
  'belived': 'believed',
  'belive': 'believe',
  'better then': 'better than',
  'bizzare': 'bizarre',
  'buisness': 'business',
  'calenders': 'calendars',
  'calender': 'calendar',
  'Carribean': 'Caribbean',
  'cemetaries': 'cemeteries',
  'cemetary': 'cemetery',
  'chasig': 'chasing',
  'chauffers': 'chauffeurs',
  'chauffer': 'chauffeur',
  'to chose': 'to choose',
  'coincidently': 'coincidentally',
  'collegues': 'colleagues',
  'collegue': 'colleague',
  'comming': 'coming',
  'commitees': 'committees',
  'commitee': 'committee',
  'completly': 'completely',
  'conciousness': 'consciousness',
  'concious': 'conscious',
  'curiousity': 'curiosity',
  'diffrent': 'different',
  'definately': 'definitely',
  'dilemnas': 'dilemmas',
  'dilemna': 'dilemma',
  'dissapeared': 'disappeared',
  'dissapears': 'disappeare',
  'dissapear': 'disappear',
  'dissapointed': 'disappointed',
  'dissapoint ': 'disappoint ',
  'dissapoint.': 'disappoint.',
  'dissapointing': 'disappointing',
  'ecstacy': 'ecstasy',
  'embarassment': 'embarrassment',
  'embarassed': 'embarrassed',
  'embarassing': 'embarrassing',
  'embarass': 'embarrass',
  'enviroment': 'environment',
  'essense': 'essence',
  'Etherium': 'Ethereum',
  'Ethetum': 'Ethereum',
  'existance': 'existence',
  'farenheit': 'fahrenheit',
  'familar': 'familiar',
  'filosophy': 'philosophy',
  'finaly': 'finally',
  'fith': 'with',
  'florescent': 'fluorescent',
  'foriegn': 'foreign',
  'forseeable': 'foreseeable',
  'fourty': 'forty',
  'foward': 'forward',
  'freindship': 'friendship',
  'freinds': 'friends',
  'freind': 'friend',
  'futher': 'further',
  'jist': 'gist',
  'glamourous': 'glamorous',
  'goverment': 'government',
  'gaurd': 'guard',
  'it happend': 'it happened',
  'let this happend': 'let this happen',
  'may happend': 'may happen',
  'to happend': 'to happen',
  'that happend': 'that happened',
  'what happend': 'what happened',
  'which happend': 'which happened',
  'happends': 'happens',
  'harrass': 'harass',
  'harrassment': 'harassment',
  'honourary': 'honorary',
  'humourous': 'humorous',
  'idiosyncracy': 'idiosyncrasy',
  'immediatly': 'immediately',
  'incidently': 'incidentally',
  'in the long term,': 'in the long run,',
  'independant': 'independent',
  'interupt': 'interrupt',
  'irresistable': 'irresistible',
  'it\'s own': 'its own',
  'knowlege': 'knowledge',
  'liase': 'liaise',
  'liason': 'liaison',
  'lollypop': 'lollipop',
  'maintainance': 'maintenance',
  'millenium': 'millennium',
  'millenials': 'millennials',
  'millenial': 'millennial',
  'millenia': 'millennia',
  'miniscule': 'minuscule',
  'mispell': 'misspell',
  'neandertal': 'neanderthal',
  'neborn': 'newborn',
  'neccessary': 'necessary',
  'necesary': 'necessary',
  'neccesary': 'necessary',
  'noticable': 'noticeable',
  'ocassionally': 'occasionally',
  'occassionally': 'occasionally',
  'ocassions': 'occasions',
  'ocassion': 'occasion',
  'occassions': 'occasions',
  'occassion': 'occasion',
  'occured': 'occurred',
  'occuring': 'occurring',
  'occurances': 'occurrences',
  'occurance': 'occurrence',
  'occurences': 'occurrences',
  'occurence': 'occurrence',
  'on of the': 'one of the',
  'otder': 'order',
  'our of': 'out of',
  'pavillion': 'pavilion',
  'people which': 'people who',
  'people wich': 'people who',
  'persistant': 'persistent',
  'pharoah': 'pharaoh',
  'peices': 'pieces',
  'peice': 'piece',
  'politican': 'politician',
  'Portugese': 'Portuguese',
  'posession': 'possession',
  'prefering': 'preferring',
  'prefered': 'preferred',
  'presense': 'presence',
  'pronounciation': 'pronunciation',
  'propoganda': 'propaganda',
  'publically': 'publicly',
  'realy': 'really',
  'recieved': 'received',
  'recieve': 'receive',
  'refered': 'referred',
  'refering': 'referring',
  'refridgerator': 'refrigerator',
  'regaurding': 'regarding',
  'rejistered': 'registered',
  'rejister': 'register',
  'religous': 'religious',
  'rember': 'remember',
  'remeber': 'remember',
  'resistence': 'resistance',
  'sandwhich': 'sandwich',
  'sandwitch': 'sandwich',
  'schedual': 'schedule',
  'scedule': 'schedule',
  'I\'ve seem': 'I\'ve seen',
  'I have seem': 'I have seen',
  'sence': 'sense',
  'seperately': 'separately',
  'seperated': 'separated',
  'seperate': 'separate',
  'seperates': 'separates',
  'seige': 'siege',
  'sencond': 'second',
  'senconds': 'seconds',
  'sever pain': 'severe pain',
  'sneak peak': 'sneak peek',
  'speshul': 'special',
  'Steamit': 'Steemit',
  'Stremit': 'Steemit',
  'succesfully': 'successfully',
  'succesful': 'successful',
  'supercede': 'supersede',
  'suprised': 'surprised',
  'suprise': 'surprise',
  'tatoo': 'tattoo',
  'there own': 'their own',
  'thet': 'they',
  'they\'re own': 'their own',
  'thier': 'their',
  'tendancy': 'tendency',
  'therefor': 'therefore',
  'threshhold': 'threshold',
  'tommorow': 'tomorrow',
  'tommorrow': 'tomorrow',
  'toung': 'tongue',
  'tounge': 'tongue',
  'truely': 'truly',
  'unatractive': 'unattractive',
  'unecessary': 'unnecessary',
  'unforseen': 'unforeseen',
  'unfortunatly': 'unfortunately',
  'untill': 'until',
  'velong': 'belong',
  'velonging': 'belonging',
  'veternary': 'veterinary',
  'wierder': 'weirder',
  'wierdo': 'weirdo',
  'wierd': 'weird',
  'whereever': 'wherever',
  'whic': 'which',
  'wich': 'which',
  'without further adieu': 'without further ado',
  'without further due': 'without further ado',
  'works really good': 'works really well',
  'your a': 'you\'re a',
  'your the': 'you\'re the',
}
  
  let INDEX = {};
  
  var api = sc2.Initialize({
    app: 'steemian-app',
    callbackURL: 'https://steemian.app/dashboard/',
    //accessToken: 'access_token',
    scope: ['vote', 'comment']
  });
  let accessToken;
  let username;
  if (window.location.search) {
    let urlParameters = window.location.search.substr(1).split("&")
    accessToken = urlParameters[0].substr(13);
    username = urlParameters[2].substr(9);
    console.log(urlParameters);
    console.log(accessToken);
    console.log(username);
    //console.log(window.location.href);
    console.log(window.location.search.substr(1));
  }
  if (accessToken) { // if logged in
    console.log("found access token")
    api.setAccessToken([accessToken]);
    api.me(function (err, res) {
      console.log(err, res)
    });
    console.log('the api has been updated with the access token');
    INDEX = createIndex(freeIllustrations);
  }
  else {
    window.location.href = api.getLoginURL();
  }

  function openSpellChecker() {
    document.getElementById("spellChecker").style.display = "inline";
    document.getElementById("freeIllustrations").style.display = "none";
    document.getElementById("about").style.display = "none";
  }

  function openFreeIllustrations() {
    document.getElementById("spellChecker").style.display = "none";
    document.getElementById("freeIllustrations").style.display = "inline";
    document.getElementById("about").style.display = "none";
  }
  
  function openAbout() {
    document.getElementById("spellChecker").style.display = "none";
    document.getElementById("freeIllustrations").style.display = "none";
    document.getElementById("about").style.display = "inline";
  }
  
  function createIndex(imageObjectArray) {
    let index = {imageIndex: {}, tagIndex: {}};
    // Create imageIndex
    for (let image of imageObjectArray) {
      for (let tag of image.tags) {
        if (index.imageIndex[tag] === undefined) {
          index.imageIndex[tag] = [image];
        }
        else if (index.imageIndex[tag].indexOf(image) === -1) {
          index.imageIndex[tag].push(image);
        }
      }
    }
    // Create tagIndex
    for (let tag of Object.keys(index.imageIndex)) {
      // For each letterIndex in tag
      for (let i of tag.split('').keys()) {
        let key = tag.substr(0, i+1);
        if (index.tagIndex[key] === undefined) {
          index.tagIndex[key] = [tag];
        }
        else if (index.tagIndex[key].indexOf(tag) === -1) {
          index.tagIndex[key].push(tag);
        }
      }
    }
    return index;
  }
  
  function elasticSearch(searchInput) {
    const index = INDEX;
    const tags = index.tagIndex[searchInput] || [];
    //document.getElementById("searchResults").innerHTML = tags; //TODO
    const results = tags.map(tag => index.imageIndex[tag]) || [];
    console.log(results);
    document.getElementById("searchResults").innerHTML = results.map(result => '<br><center><img src="' + result[0].url + '"style="width:50%;height:50%;"></center><center><code>' + result[0].steemitLink + '</code></center>').join('\n');
  }
  
  function runCorrectText(value) {
    var input = value;
    document.getElementById("correctionOutput").innerHTML = correctText(input, MISTAKEDICTIONARY);
  }
  
  function correctText(text, mistakeDictionary) {
    const alphaNumerical = char => 'abcdefghijklmnopqrstuvwxyz1234567890'.indexOf(char) === -1 ? false : true;
    let lowerText = text.toLowerCase();
    let fixedText = text;
    for (let mistake of Object.keys(mistakeDictionary)) {
      let mistakeIndex = lowerText.indexOf(mistake.toLowerCase());
      if (mistakeIndex !== -1 && (mistakeIndex-1 < 0 || !alphaNumerical(lowerText.charAt(mistakeIndex-1))) && (mistakeIndex+mistake.length === lowerText.length || !alphaNumerical(lowerText.charAt(mistakeIndex+mistake.length)))) {
        fixedText = fixedText.substr(0, mistakeIndex) + '<span title="suggestion: ' + mistakeDictionary[mistake] + '" style="color:red">' + fixedText.substr(mistakeIndex, mistake.length) + '</span>' + fixedText.substring(mistakeIndex + mistake.length);
        lowerText = fixedText.toLowerCase();
      }
    }
    return fixedText;
  }
  /**
  function correctText(text, mistakeDictionary) {
    return text.split(' ').map(word => mistakeDictionary[word] ? '<span title="suggestion: ' + mistakeDictionary[word] + '" style="color:red">' + word + '</span>' : word).join(' ');
  }
  */
</script>
  
<body>
  <div class="btn-group" style="width:100%">
    <button style="width:33%" onclick="openSpellChecker()">Spell checker</button>
    <button style="width:33%" onclick="openFreeIllustrations()">Free illustrations</button>
    <button style="width:33%" onclick="openAbout()">About</button>
  </div>
  
  <!-- Spell Checker -->
  <div id=spellChecker style="display:inline;text-align:center">
    <form>
      Paste your text to highlight common mistakes:<br>
      <textarea id="correctionInput" name="input" rows="10" cols="80" oninput="runCorrectText(value)"></textarea>
	</form>
	<br>
	<div id="correctionOutput" style="text-align:left"></div>
  </div>
  
  <!-- Free Illustrations -->
  <div id=freeIllustrations style="display:none;text-align:center">
    <form>
      Search:<br>
      <input autocomplete="off" type="text" name="searchInput" oninput="elasticSearch(value)"><br>
    </form>
    <p id="searchResults"></p>
  </div>
  
  <!-- About -->
  <div id=about style="display:none;text-align:center">
    <h1>About information goes here</h1>
  </div>
</body>